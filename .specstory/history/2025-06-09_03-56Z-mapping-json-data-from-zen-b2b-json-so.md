<!-- Generated by SpecStory -->

# Mapping JSON data from ZEN_B2B_JSON_SO (2025-06-09 03:56Z)

_**User**_

@Codebase 我現在要mapping json，下面是飛力達提供的Sample code，
請參照這個Json格式，幫我從ZEN_B2B_JSON_SO撈資料去Mapping JSON格式的"Orders"那段。
若你有不確定不清楚的，都要先跟我確認。

{
  "sign": "YTAwOTAxYzQ3YjgzOThhOTk2YzZmZWE4NjUwNjQ4MjM=",
  "part_code": "D3101D1148",
  "request_time": "2025-05-26 18:17:39",
  "data": {
    "Orders": [
      {
        "ord_type": "0",
        "busi_date": "2025/05/27",
        "ref_no": "OM2505260044",
        "consignee_company": "華隼股份有限公司",
        "bill_to": "深圳寶安區西鄉街道107國道西鄉段467號(固戍路口邊)愉盛工業區5棟4樓",
        "ref_consignee_code": "87537",
        "consignee_tel": "00852-24399878",
        "consignee_contact": "陳恆司(CHAN)陳恆司(CHAN)",
        "consignee_addr": "香港元朗廈村廈村路DD124地段,4-7號",
        "OrderLists": [
          {
            "ref_sku_code": "11-330207-00G",
            "g_name": "TRANSISTOR",
            "g_brand": "FUJI",
            "g_model": "",
            "piece_num": "1200",
            "price": "1.58",
            "total_price": "1896",
            "po_no": "W421-2412190014",
            "po_line": "2",
            "invoice_no": "OM2505260044",
            "invoice_date": "2025/05/27",
            "relabel_sku_code": "FGZ75XS65C-S31PP",
            "note": "每捲貼Barcode 內箱貼Barcode 外箱貼Barcode D/C 不可超過二年 貼客戶外箱標籤            出貨時需貼上客戶內箱外箱二維碼標簽出貨，標簽每次出貨前助理會提供給倉庫，APT60DQ60BG出貨只出2個腳的",
            "ext_1": "DEFAULT",
            "ext_3": "",
            "ext_4": "",
            "dn_no": "2617232",
            "ext_5": "",
            "shipping_mark": "D",
            "ext_6": "",
            "ext_7": "",
            "ref_division_name": "第二華南業一處二部",
            "rma_no": "",
            "pre_po_no": ""
          }
        ],
        "ShippingInstructions": [
          {
            "qc_param": "廠區：中山芝安",
            "qc_type": "TY"
          }
        ]
      }
    ]
  }
}

---

_**Assistant**_

<think><details><summary>Thought Process</summary>**Analyzing JSON Structure**

I'm currently focused on dissecting the target JSON structure for "Orders". The challenge lies in accurately mapping the data from the `ZEN_B2B_JSON_SO` table. I'm paying close attention to the nested elements and how they relate to the source data, especially the "ord_type" field, since this will require precise data manipulation.


**Decoding Order Mapping**

I've been examining the intricacies of the "Orders" JSON structure in more detail. I now have a clearer understanding of how fields like `ord_type` and `busi_date` map directly from the `ZEN_B2B_JSON_SO` table. I'm focusing on handling the nested `OrderLists` array, ensuring that each item is correctly associated with its parent order data. I am finding ways to parse the `consignee` data to match.


**Connecting Table Columns**

I'm now investigating the specific table columns to determine the correct mappings. I'm focusing on aligning the  fields in the target JSON structure with the available columns, such as `SENDER_CODE`, `RECEIVER_CODE`, `INVOICE_NO`, `ORDER_NO`, and related fields. My goal is to find relationships between the columns and the target JSON elements. I'm giving special attention to how to deal with fields that don't have a direct mapping.


**Establishing Field Mappings**

I'm now deep-diving into the `ZEN_B2B_JSON_SO` table's columns to establish direct mappings to the target JSON's fields. I've noted `INVOICE_NO` and `ORDER_NO` as potential matches for `ref_no`, focusing on how these identifiers relate across both datasets. Also, `ord_type` seems to have a direct mapping with  `ZEN_B2B_JSON_SO` values.


**Refining Field Associations**

I'm now zeroing in on matching `ZEN_B2B_JSON_SO` columns to the target JSON's fields, specifically for the "Orders" section. I believe `INVOICE_NO` will be used as the `ref_no`. I'm starting to build out direct mappings for the JSON fields at the root level.


**Establishing Detailed Mappings**

I'm now determining how each column from `ZEN_B2B_JSON_SO` maps to the target JSON's fields, focusing on the `Orders` and `OrderLists` sections. I've successfully mapped `INVOICE_NO` and `INVOICE_DATE` at the root level, and begun mapping `ZT_PART_NO` and `ITEM_DESC` within `OrderLists`. I will next review the `CUST_CODE` and `CUST_NAME` to verify those mappings.


**Establishing Comprehensive Mappings**

I'm currently finalizing the mapping of `ZEN_B2B_JSON_SO` columns to the target JSON structure. I've successfully correlated `ord_type`, `INVOICE_NO`, `CUST_NAME`, and other key fields at the root level. I am now focused on the detailed mapping of the `OrderLists` array, correlating item-specific data like `ZT_PART_NO` and `ITEM_DESC`. I will now proceed to the `ShippingInstructions` mapping.


**Establishing Comprehensive Mapping Refinements**

I'm now focusing on mapping all applicable fields from `ZEN_B2B_JSON_SO` to the JSON structure. I've successfully correlated the core order details, including `ord_type`, `INVOICE_NO`, `CUST_NAME`, and address information. My current focus is refining the `OrderLists` array, ensuring precise matches for item-specific details like `ZT_PART_NO`, `ITEM_DESC`, and quantities. I've also identified potential mappings for auxiliary fields.


**Refining Mapping Logic**

I've made substantial strides in mapping the `ZEN_B2B_JSON_SO` table's columns to the target JSON structure. I've successfully correlated root-level fields like `ord_type`, `INVOICE_NO`, `CUST_NAME`, and address details. My main focus now is the precise mapping within the `OrderLists` array, specifically addressing `ZT_PART_NO`, `ITEM_DESC`, and quantities, to ensure accuracy and relevance. I will now tackle the fields under the `ShippingInstructions` key.


**Establishing Column Correlations**

I'm now cross-referencing the `ZEN_B2B_JSON_SO` columns with the target JSON structure, focusing on both "Orders" and "OrderLists" elements. I've pinpointed several direct mappings, like `INVOICE_NO` to `ref_no` and `ord_type` for the root-level order information, and  I'm correlating `ZT_PART_NO`, `ITEM_DESC`, and quantities within the nested "OrderLists" array. I've successfully mapped the `ShippingInstructions` elements as well.


**Establishing Initial Mappings**

I'm now identifying correspondences between `ZEN_B2B_JSON_SO` columns and the target JSON structure, focusing primarily on the "Orders" level. I believe `INVOICE_NO` maps to `ref_no`, `ORD_TYPE` is a direct match, and `CUST_NAME` aligns with `consignee_company`. I will now proceed to review individual fields.


**Establishing Detailed Mapping Refinements**

I'm now zeroing in on refinements for the established mappings. I've noted a slight discrepancy in the  `consignee_tel` field, as the user may expect more accurate results. I'm focusing on ensuring consistency and accuracy in the data transformation process, particularly with the formatting of dates. I am also working on more complex scenarios.


**Mapping the JSON Structure**

I've significantly progressed in my analysis, and have generated a detailed mapping of the `ZEN_B2B_JSON_SO` columns to the target JSON structure, focusing on the `Orders` and `OrderLists` sections. I am particularly concerned with the `shipping_mark`, as I have proposed the mapping. I'm now ready to present a preliminary mapping and am awaiting feedback from the user.


**Refining the Column Mapping**

I'm now clarifying the mappings for the target JSON fields, specifically addressing `shipping_mark`, and related fields. I'm carefully reviewing potential mappings like `SHIP_NOTICE` to ensure accuracy. I've also identified potential mappings for auxiliary fields in the `OrderLists` array.

**Finalizing JSON Mapping**

I'm now integrating the mapping plan for the JSON structure, focusing on the `Orders` and `OrderLists` sections. I've successfully cross-referenced the columns within `ZEN_B2B_JSON_SO` with the target JSON fields, accounting for potential mapping discrepancies. Currently, I'm working to solidify the connections, ensuring accuracy and complete coverage. I am confident I'm close to a working mapping.


**Revising Mapping Proposal**

I've revised the mapping, ensuring accuracy. I've now clarified the suggested correlation between the fields in `ZEN_B2B_JSON_SO` and their respective JSON counterparts. Also, I've outlined the missing mappings with their possible candidates to guide the user's review.

I have updated the detailed mapping proposal, including the `OrderLists` section, to address previous feedback. I've also integrated my questions and key considerations to enable efficient validation. I have proposed possible matches for unmapped elements.


**Formulating JSON Mappings**

I've completed a detailed analysis of the provided data and constructed a preliminary mapping plan, focusing on the intricate relationships between the `ZEN_B2B_JSON_SO` columns and the target JSON structure. I've now identified potential mappings for all the key fields and will present these in a structured manner to facilitate efficient review. I'm also preparing a comprehensive list of questions to address any lingering uncertainties before I begin building out the final SQL query.


</details></think>

---

好的，收到您的需求。您希望將 `ZEN_B2B_JSON_SO` 資料表的資料，對應到飛力達提供的 JSON 格式中 `Orders` 的部分。

我分析了您提供的 SQL 檔案 (`om_extract.sql`, `st_extract.sql`, `rt_extract.sql`, `mi_extract.sql`, `mv_extract.sql`) 來推斷 `ZEN_B2B_JSON_SO` 的欄位，並整理出以下的對應關係。由於我是基於現有 SQL 的查詢欄位來推測，有些對應關係需要請您確認。

### Orders 層級對應
這部分應該是每個 `INVOICE_NO` (發票號碼) 為一筆訂單資料。

| JSON 欄位 | `ZEN_B2B_JSON_SO` 欄位 | 備註 |
| --- | --- | --- |
| `ord_type` | `ORD_TYPE` | |
| `busi_date` | `INVOICE_DATE` | 需要格式化為 `YYYY/MM/DD` |
| `ref_no` | `INVOICE_NO` | |
| `consignee_company` | `CUST_NAME` | |
| `bill_to` | `INVOICE_ADDRESS` | |
| `ref_consignee_code`| `CUST_CODE` | |
| `consignee_tel` | `SHIP_TO_PHONE` | |
| `consignee_contact` | `SHIP_TO_CONTACT` | |
| `consignee_addr` | `DELIVERY_ADDRESS` | |

### OrderLists 層級對應
這是訂單中的品項列表。

| JSON 欄位 | `ZEN_B2B_JSON_SO` 欄位 | 備註 |
| --- | --- | --- |
| `ref_sku_code` | `ZT_PART_NO` | |
| `g_name` | `ITEM_DESC` | |
| `g_brand` | `BRAND` | |
| `g_model` | `ITEM_MODE` | |
| `piece_num` | `QUANTITY` | |
| `price` | `UNIT_PRICE` | |
| `total_price` | `AMOUNT` | |
| `po_no` | `CUST_PO` | |
| `po_line` | `CUST_POLINE` | |
| `invoice_no` | `INVOICE_NO` | |
| `invoice_date` | `INVOICE_DATE` | 需要格式化為 `YYYY/MM/DD` |
| `relabel_sku_code` | `CUST_PN` | |
| `note` | `ORDER_LINE_MEMO` | |
| `ext_1` | `FROM_SUBINVENTORY_CODE` | 範例為 "DEFAULT"，此對應是否正確？ |
| `dn_no` | `ORDER_NO` | `dn_no` 是否為 Delivery Note number？對應到 Oracle 的訂單號碼 (`ORDER_NO`) 是否正確？ |
| `ref_division_name` | `DEPT` | |
| `rma_no` | `RMA_NUMBER` | |
| `pre_po_no` | `ORI_PO_NO` | `rt_extract.sql` 中有此欄位，但其他單據似乎沒有。`ZEN_B2B_JSON_SO` 是否有此欄位？ |

### ShippingInstructions 層級對應

| JSON 欄位 | `ZEN_B2B_JSON_SO` 欄位 | 備註 |
| --- | --- | --- |
| `qc_param` | `SEGMENT1`, `SEGMENT2` | 建議組合成 `'廠區：' || SEGMENT1 || SEGMENT2` |
| `qc_type` | `QC_TYPE` | |

---

### **待確認與未對應的欄位**

**`OrderLists` 中有幾個欄位我還不確定如何對應，需要請您協助確認：**

*   `shipping_mark`: 範例值為 "D"。 `ZEN_B2B_JSON_SO` 中有 `SHIP_NOTICE` 和 `SHIP_NOTES` 欄位，請問應該對應到哪一個？或是另有來源？
*   `ext_3`, `ext_4`, `ext_5`, `ext_6`, `ext_7`: 這幾個擴充欄位目前是空的。`ZEN_B2B_JSON_SO` 中還有一些欄位如 `CUST_PO2`, `SUPPLIER_PARTNO`, `CUST_PART_NO2`, `PO_REMARK`, `INV_AND_PAC` 等，請問是否需要對應到這些擴充欄位？

請您檢視以上的對應關係，並針對我提出的問題給予回覆。確認後，我就可以為您撰寫產生 JSON 的 SQL 查詢。

---

